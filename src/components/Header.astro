---
import Logo from '../assets/icons/logo-black.svg';
---

<header 
  class="px-6 py-4 fixed z-10 w-full flex items-stretch justify-between transition-all duration-300 ease-in-out lg:py-0 bg-[--color-background]"
  id="header"
>    
  <div class="flex items-center relative z-20">
    <a href="/" aria-label="Accueil">
      <Logo class="w-20" />
    </a>
  </div>

  <div class="hidden lg:block absolute bottom-0 left-0 w-full h-[2px] bg-transparent z-0">
    <div class="absolute left-0 w-[calc(50%-28px)] h-full bg-black"></div>
    <div class="absolute right-0 w-[calc(50%-28px)] h-full bg-black"></div>
    <div class="absolute left-1/2 -translate-x-1/2 translate-y-[-100%] w-[60px] h-[30px] bg-[--color-background] border-x-[2px] border-t-[2px] border-black rounded-t-full z-10"></div>
    <div class="absolute left-1/2 -translate-x-1/2 translate-y-[-50%] w-[32px] h-[32px] bg-[--color-background] border-[2px] border-black rounded-full flex items-end overflow-hidden z-20 rotate-180">
      <div class="w-full h-1/2 bg-black"></div>
    </div>
  </div>

  <div class="flex items-center gap-4 lg:flex-row-reverse">
    <button 
      class="group relative z-20 flex h-6 w-8 flex-col justify-between *:h-[2px] *:w-full *:bg-black *:transition-all *:duration-300 *:ease lg:hidden"
      id="menu-btn"
      aria-label="Menu"
      aria-controls="menu"
      aria-expanded="false"
    >
      <span class="group-aria-expanded:translate-y-[10.5px] group-aria-expanded:rotate-135"></span>
      <span class="group-aria-expanded:opacity-0"></span>
      <span class="group-aria-expanded:-translate-y-[10.5px] group-aria-expanded:-rotate-135"></span>
    </button>

    <nav 
      class="visible fixed z-10 inset-0 bg-(--color-blue) text-2xl text-black opacity-100 transition-all duration-300 ease-in-out max-lg:aria-hidden:invisible max-lg:aria-hidden:opacity-0 lg:relative lg:flex lg:items-center lg:bg-transparent lg:text-sm lg:font-bold lg:uppercase lg:tracking-wide lg:text-black lg:opacity-100"
      id="menu"
      aria-hidden="true"
    >
      <ul class="mt-[25vh] mx-16 lg:m-0 lg:flex *:relative *:overflow-hidden *:lg:before:absolute *:lg:before:bottom-0 *:lg:before:left-0 *:lg:before:h-2 *:lg:before:w-full *:lg:before:translate-y-2 *:lg:before:transition-all *:lg:before:duration-300 *:lg:before:ease-in-out *:lg:hover:before:translate-y-0">
        <li class="lg:before:bg-(--color-red)">
          <a class="block px-5 py-4 lg:py-8" href="/festival">Le Festival</a>
        </li>
        
        <!-- Menu Programmation avec sous-menu modifié -->
        <li class="lg:before:bg-(--color-orange) group lg:hover:overflow-visible">
          <div class="relative">
            <a class="block px-5 py-4 lg:py-8 flex items-center cursor-pointer" href="/programmation">
              Programmation
              <svg class="ml-2 w-4 h-4 hidden lg:block" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
              </svg>
            </a>
            
            <!-- Sous-menu desktop amélioré -->
            <div class="lg:absolute lg:left-0 lg:top-full lg:invisible lg:opacity-0 lg:group-hover:visible lg:group-hover:opacity-80 lg:bg-(--color-background) lg:shadow-md lg:rounded-md lg:p-2 lg:w-64 lg:z-30 lg:transition-all lg:duration-300 lg:border-2 lg:border-black">
              <!-- Barre verticale orange pour mobile -->
              <div class="lg:hidden w-1  absolute left-3 top-0 bottom-0"></div>
              
              <ul class="lg:py-2">
                <li class="lg:hover:bg-(--color-orange) lg:rounded">
                  <a class="block px-12 py-4 lg:px-5 lg:py-3" href="/films">
                    <span class="lg:hidden inline-block w-1 h-full bg-(--color-orange) mr-2"></span>
                    Programme des films
                  </a>
                </li>
                <li class="lg:hover:bg-(--color-orange) lg:rounded">
                  <a class="block px-12 py-4 lg:px-5 lg:py-3" href="/activites">
                    <span class="lg:hidden inline-block w-1 h-full bg-(--color-orange) mr-2"></span>
                    Programme des activités
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </li>
        
        <li class="lg:before:bg-(--color-yellow)">
          <a class="block px-5 py-4 lg:py-8" href="/invites">Invités</a>
        </li>
        <li class="lg:before:bg-(--color-blue)">
          <a class="block px-5 py-4 lg:py-8" href="/informations">Infos pratiques</a>
        </li>
      </ul>
    </nav>
  </div>
</header>

<script>
    // Gestion du menu mobile
    const toggle = document.querySelector("#menu-btn");
    const nav = document.querySelector("#menu");
    const page = document.body;
    
    if (toggle && nav) {
      toggle.addEventListener("click", () => {
        const isOpen = toggle.ariaExpanded === "true";
        toggle.ariaExpanded = String(!isOpen);
        nav.ariaHidden = String(isOpen);
        page.classList.toggle("noscroll", !isOpen);
      });
    }

    // Gestion du scroll header
    const navBar = document.querySelector("#header");
    let lastScrollY = window.scrollY;
    let ticking = false;
    const offset = 205;

    function handleScroll() {
      const currentScrollY = window.scrollY;

      // Suppression de la gestion du background pour le garder opaque
      if (currentScrollY > lastScrollY && currentScrollY > offset) {
        navBar.classList.add("-translate-y-full");
      } else {
        navBar.classList.remove("-translate-y-full");
      }

      lastScrollY = currentScrollY;
      ticking = false;
    }

    window.addEventListener("scroll", () => {
      if (!ticking) {
        window.requestAnimationFrame(handleScroll);
        ticking = true;
      }
    });

    // Gestion du sous-menu mobile uniquement
    document.addEventListener('DOMContentLoaded', () => {
      const progMenuItem = document.querySelector('.group > div > div'); // Modifié pour cibler le bon élément
      
      if (progMenuItem && window.innerWidth < 1024) {
        progMenuItem.addEventListener('click', (e) => {
          const submenu = e.currentTarget.nextElementSibling;
          if (submenu) {
            e.preventDefault();
            submenu.classList.toggle('hidden');
          }
        });
      }
    });
</script>